<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Login Feature Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            border-left: 4px solid #007bff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #007bff;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .pending {
            color: #ffc107;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .file-checklist {
            list-style: none;
            padding: 0;
        }
        .file-checklist li {
            padding: 8px;
            margin: 4px 0;
            background: white;
            border-radius: 4px;
        }
        .file-checklist li::before {
            content: '‚úÖ ';
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>üß™ Demo Login Feature Test Dashboard</h1>
    <p>This page tests the demo login feature implementation for ApexCoach AI.</p>

    <div class="test-section">
        <h2>üìã Implementation Checklist</h2>
        <ul class="file-checklist">
            <li>Backend migrated from SQLite to Azure Postgres</li>
            <li>Database migration created (001_add_demo_fields.sql)</li>
            <li>Demo user seed script (seedDemoUsers.ts)</li>
            <li>Demo data seed script (seedDemoData.ts)</li>
            <li>User repository extended with demo methods</li>
            <li>Auth routes updated (GET /auth/demo-users, POST /auth/demo-login)</li>
            <li>Backend config with ENABLE_DEMO_LOGIN flag</li>
            <li>AuthContext extended with demoLoginWithRole()</li>
            <li>DemoLoginButtons component created</li>
            <li>Login page updated with demo buttons</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîå API Endpoint Tests</h2>
        <p>Test the backend API endpoints:</p>

        <div>
            <button onclick="testDemoUsersEndpoint()">Test GET /auth/demo-users</button>
            <button onclick="testDemoLoginEndpoint()">Test POST /auth/demo-login</button>
            <button onclick="testAllRoles()">Test All Demo Roles</button>
        </div>

        <div id="api-results" style="margin-top: 15px;">
            <p class="pending">Click buttons above to test API endpoints</p>
        </div>
    </div>

    <div class="test-section">
        <h2>üóÑÔ∏è Database Schema</h2>
        <p>Migration SQL adds these fields to the users table:</p>
        <pre>
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_demo BOOLEAN DEFAULT FALSE;
ALTER TABLE users ADD COLUMN IF NOT EXISTS demo_role VARCHAR(50);
ALTER TABLE users ADD COLUMN IF NOT EXISTS demo_label TEXT;

CREATE INDEX IF NOT EXISTS idx_users_demo
ON users (is_demo, demo_role)
WHERE is_demo = TRUE;</pre>
    </div>

    <div class="test-section">
        <h2>üë• Demo Users</h2>
        <p>Three demo accounts will be created:</p>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: white;">
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Email</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Role</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Label</th>
            </tr>
            <tr>
                <td style="padding: 10px;">demo.admin@apexcoachai.com</td>
                <td style="padding: 10px;">ADMIN</td>
                <td style="padding: 10px;">Admin Demo - Full Platform Access</td>
            </tr>
            <tr style="background: white;">
                <td style="padding: 10px;">demo.coach@apexcoachai.com</td>
                <td style="padding: 10px;">COACH</td>
                <td style="padding: 10px;">Coach Demo - Content Creator Experience</td>
            </tr>
            <tr>
                <td style="padding: 10px;">demo.client@apexcoachai.com</td>
                <td style="padding: 10px;">USER</td>
                <td style="padding: 10px;">Client Demo - End-User Journey</td>
            </tr>
        </table>
        <p style="margin-top: 15px;"><strong>Password:</strong> demo123 (all accounts)</p>
    </div>

    <div class="test-section">
        <h2>üöÄ Deployment Status</h2>
        <div id="deployment-status">
            <p class="pending">‚è≥ Testing production deployment...</p>
            <button onclick="checkDeployment()">Check Production Status</button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api.apexcoachai.shtrial.com';
        const FRONTEND_URL = 'https://apexcoachai.shtrial.com';

        async function testDemoUsersEndpoint() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="pending">‚è≥ Testing GET /auth/demo-users...</p>';

            try {
                const response = await fetch(`${API_BASE}/auth/demo-users`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <p class="success">‚úÖ GET /auth/demo-users - Success!</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    const text = await response.text();
                    resultsDiv.innerHTML = `
                        <p class="error">‚ùå GET /auth/demo-users - Failed (${response.status})</p>
                        <pre>${text}</pre>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <p class="error">‚ùå GET /auth/demo-users - Error</p>
                    <pre>${error.message}</pre>
                    <p>This likely means the backend is not deployed yet or ENABLE_DEMO_LOGIN is not set to true.</p>
                `;
            }
        }

        async function testDemoLoginEndpoint() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="pending">‚è≥ Testing POST /auth/demo-login...</p>';

            try {
                const response = await fetch(`${API_BASE}/auth/demo-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ role: 'coach' })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <p class="success">‚úÖ POST /auth/demo-login (coach) - Success!</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    const text = await response.text();
                    resultsDiv.innerHTML = `
                        <p class="error">‚ùå POST /auth/demo-login - Failed (${response.status})</p>
                        <pre>${text}</pre>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <p class="error">‚ùå POST /auth/demo-login - Error</p>
                    <pre>${error.message}</pre>
                `;
            }
        }

        async function testAllRoles() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="pending">‚è≥ Testing all demo roles...</p>';

            const roles = ['admin', 'coach', 'client'];
            let html = '<h3>Testing All Demo Roles:</h3>';

            for (const role of roles) {
                try {
                    const response = await fetch(`${API_BASE}/auth/demo-login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ role })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        html += `<p class="success">‚úÖ ${role} - Logged in as ${data.user.email}</p>`;
                    } else {
                        html += `<p class="error">‚ùå ${role} - Failed (${response.status})</p>`;
                    }
                } catch (error) {
                    html += `<p class="error">‚ùå ${role} - Error: ${error.message}</p>`;
                }
            }

            resultsDiv.innerHTML = html;
        }

        async function checkDeployment() {
            const statusDiv = document.getElementById('deployment-status');
            statusDiv.innerHTML = '<p class="pending">‚è≥ Checking deployment status...</p>';

            let html = '<h3>Deployment Status:</h3>';

            // Check backend API
            try {
                const apiResponse = await fetch(`${API_BASE}/auth/demo-users`, { credentials: 'include' });
                if (apiResponse.ok) {
                    html += '<p class="success">‚úÖ Backend API is deployed and responding</p>';
                } else {
                    html += `<p class="error">‚ùå Backend API returned ${apiResponse.status}</p>`;
                }
            } catch (error) {
                html += '<p class="error">‚ùå Backend API is not accessible</p>';
            }

            // Check frontend
            try {
                const frontendResponse = await fetch(FRONTEND_URL);
                if (frontendResponse.ok) {
                    html += '<p class="success">‚úÖ Frontend is deployed</p>';
                } else {
                    html += '<p class="error">‚ùå Frontend is not accessible</p>';
                }
            } catch (error) {
                html += '<p class="error">‚ùå Frontend is not accessible</p>';
            }

            html += '<br><p><a href="' + FRONTEND_URL + '" target="_blank">Open ApexCoach AI ‚Üí</a></p>';

            statusDiv.innerHTML = html;
        }

        // Run deployment check on load
        window.addEventListener('load', () => {
            setTimeout(checkDeployment, 1000);
        });
    </script>
</body>
</html>
